# Воркер

Воркер живёт своей жизнью.
Работает с внешними интерфейсами:

- IndexedDB
- ZenMoney API

Данные состоят из нескольких слоёв:

## server_data

Синхронизированные даннные (лежат по id). Обновляются по нескольким причинам:

- загрузили сохранённые локальные данные
- получили данные с сервера
- загрузили данные из JSON
- разлогинились (стёрли всё)

## local_diff

Локальные изменения данных, которые ещё не синхронизировались с сервером. Причины изменения:

- пользователь меняет данные
- получили данные с сервера (надо удалить то что синхронизировалось)
- разлогинились (стёрли всё)

## current_state

Комбинация из `server_data` и `local_diff`. Обновляется реактивно.

## derivatives

Вычисляемые обогащённые данные. Обновляются реактивно.
Эти данные в конце собираются и отправляются на фронт (только изменения?).

- Основные данные из `current_state` обогащённые hidden data
- Бюджеты
- Количество локальных изменений
- Статистика?

Помимо обновления данных у воркера есть методы:

- getFilteredTransactions - получить список отфильтрованых транзакций
- applyPatch - применить изменения к данным
- loadJSON - загрузить данные из JSON
- logIn - сохранить токен и запустить синхронизацию
- logOut - стереть все данные
- loadLocalData - загрузиться из IndexedDB
- reloadData - перезагрузить данные из сервера
- ...
